<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Notifications - FolderExplorer.Web</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>FolderExplorer.Web</h1>
            <nav>
                <a href="/">Home</a>
                <a href="/explore.html">Explore</a>
                <a href="/upload.html">Upload</a>
                <a href="/my-folders.html">My Folders</a>
                <a href="/notifications.html">Notifications</a>
            </nav>
        </div>
    </header>
    <main>
        <div class="container">
            <h2>Collaboration Requests</h2>
            <div id="requests-list"></div>
        </div>
    </main>
    <script>
        async function loadRequests() {
            const res = await fetch('/.netlify/functions/pending-collabs');
            if (res.status === 401) {
                window.location.href = '/generate-passpin.html';
                return;
            }
            const requests = await res.json();
            const container = document.getElementById('requests-list');
            if (requests.length === 0) {
                container.innerHTML = '<p>No pending requests.</p>';
                return;
            }
            container.innerHTML = requests.map(r => `
                <div class="folder-card">
                    <p><strong>${r.users.username}</strong> wants to collaborate on <strong>${r.folders.name}</strong></p>
                    <button onclick="respond('${r.id}', 'accepted')">Accept</button>
                    <button onclick="respond('${r.id}', 'rejected')">Reject</button>
                </div>
            `).join('');
        }

        window.respond = async (collabId, action) => {
            const res = await fetch('/.netlify/functions/respond-collab', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ collabId, action })
            });
            if (res.ok) {
                loadRequests();
            } else {
                alert('Failed to respond');
            }
        };

        loadRequests();
    </script>
</body>
</html>
